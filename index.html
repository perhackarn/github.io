<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Landbys Cup ‚Äî Firestore</title>

    <!-- React + Babel + Tailwind -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase (module) -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        addDoc,
        doc,
        setDoc,
        updateDoc,
        deleteDoc,
        onSnapshot
      } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

      // ======= BYT UT MED DIN FIREBASE KONFIG =========
      const firebaseConfig = {
          apiKey: "AIzaSyB0C2ecPKLnbIMzWuj9LHcZa_fa9c47GzM",
          authDomain: "landbys-cup-2288f.firebaseapp.com",
          projectId: "landbys-cup-2288f",
          storageBucket: "landbys-cup-2288f.firebasestorage.app",
          messagingSenderId: "369843977735",
          appId: "1:369843977735:web:57c142f411531280ed74a2"
      };
      // =================================================

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // Exportera till window s√• att kod i text/babel kan anv√§nda dem
      window.db = db;
      window.fdb = { collection, addDoc, doc, setDoc, updateDoc, deleteDoc, onSnapshot };
    </script>

    <style>
        /* Extra sm√• tweaks */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        @media print {
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
                const { useState, useEffect } = React;
                const { db, fdb } = window;

                // Simple icon components (same as original)
                const Target = ({ className = "w-6 h-6" }) => (
                  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>
                );
                const Search = ({ className = "w-4 h-4" }) => (
                  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                );
                const Plus = ({ className = "w-4 h-4" }) => (
                  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg>
                );
                const Trophy = ({ className = "w-5 h-5" }) => (
                  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55.47.98.97 1.21C12.04 18.75 14 20 16 20s4-1.25 5.03-1.79c.5-.23.97-.66.97-1.21v-2.34"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
                );
                const Users = ({ className = "w-6 h-6" }) => (
                  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                );
                const Calendar = ({ className = "w-6 h-6" }) => (
                  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                );

                function App() {
                  // State
                  const [competitions, setCompetitions] = useState([]);
                  const [shooters, setShooters] = useState([]);
                  const [scores, setScores] = useState({}); // { "shooterId-competitionId": { "0":10, "1":8, ... } }

                  const [activeTab, setActiveTab] = useState('competitions');
                  const [menuOpen, setMenuOpen] = useState(false);
                  const [selectedCompetition, setSelectedCompetition] = useState(null);
                  const [selectedStation, setSelectedStation] = useState(1);

                  // UI state for competitions
                  const [editingCompetition, setEditingCompetition] = useState(null);
                  // UI state for shooters
                  const [editingShooter, setEditingShooter] = useState(null);
                  const [newShooter, setNewShooter] = useState({ name: '', city: '', class: '√∂ppen' });
                  const [newCompetition, setNewCompetition] = useState({ name: '', date: '' });

                  // Scoring UI
                  const [searchTerm, setSearchTerm] = useState('');
                  const [selectedShooter, setSelectedShooter] = useState(null);
                  const [currentShots, setCurrentShots] = useState(['', '', '', '', '']);

                  const classes = ['√∂ppen','dam','veteran','ungdom','junior med st√∂d'];
                  const menuItems = [
                    { id: 'competitions', label: 'Delt√§vlingar', icon: Calendar },
                    { id: 'shooters', label: 'Skyttar', icon: Users },
                    { id: 'scoring', label: 'Registrera Po√§ng', icon: Target },
                    { id: 'results', label: 'Resultatlista', icon: Trophy }
                  ];

                  // ---------- Firestore realtime listeners ----------
                  useEffect(() => {
                    // Competitions
                    const unsubC = fdb.onSnapshot(fdb.collection(db, "competitions"), snap => {
                      const arr = snap.docs.map(d => ({ id: d.id, ...d.data() })).sort((a,b) => (a.date||'').localeCompare(b.date||''));
                      setCompetitions(arr);
                      // ensure selectedCompetition
                      if (!selectedCompetition && arr.length > 0) setSelectedCompetition(arr[0].id);
                    });

                    // Shooters
                    const unsubS = fdb.onSnapshot(fdb.collection(db, "shooters"), snap => {
                      const arr = snap.docs.map(d => ({ id: d.id, ...d.data() })).sort((a,b) => (a.startNumber||0) - (b.startNumber||0));
                      setShooters(arr);
                    });

                    // Scores
                    const unsubSc = fdb.onSnapshot(fdb.collection(db, "scores"), snap => {
                      const obj = {};
                      snap.docs.forEach(d => {
                        const data = d.data() || {};
                        obj[d.id] = data.scores || {};
                      });
                      setScores(obj);
                    });

                    return () => { unsubC(); unsubS(); unsubSc(); };
                  }, []); // eslint-disable-line

                  // If competitions change ensure selectedCompetition exists
                  useEffect(() => {
                    if (competitions.length > 0 && !selectedCompetition) {
                      setSelectedCompetition(competitions[0].id);
                    }
                  }, [competitions]); // eslint-disable-line

                  // ---------- Helper functions for scores ----------
                  const getStationScore = (shooterId, compId, stationIndex) => {
                    const key = `${shooterId}-${compId}`;
                    const shooterScores = scores[key] || {};
                    return shooterScores[stationIndex] || 0;
                  };

                  const getTotalScore = (shooterId, compId) => {
                    const key = `${shooterId}-${compId}`;
                    const shooterScores = scores[key] || {};
                    return Object.values(shooterScores).reduce((sum, v) => sum + (parseInt(v)||0), 0);
                  };

                  // ---------- Competitions CRUD ----------
                  const addCompetition = async () => {
                    try {
                      if (!newCompetition.name || !newCompetition.date) { alert('Fyll i namn och datum'); return; }
                      await fdb.addDoc(fdb.collection(db, "competitions"), {
                        name: newCompetition.name,
                        date: newCompetition.date
                      });
                      setNewCompetition({ name: '', date: '' });
                    } catch (err) { console.error(err); alert('Fel vid skapande av delt√§vling: ' + err.message); }
                  };

                  const startEditCompetition = (comp) => setEditingCompetition({ id: comp.id, name: comp.name, date: comp.date });

                  const saveEditCompetition = async () => {
                    try {
                      if (!editingCompetition || !editingCompetition.name || !editingCompetition.date) return;
                      const ref = fdb.doc(db, "competitions", editingCompetition.id);
                      await fdb.updateDoc(ref, { name: editingCompetition.name, date: editingCompetition.date });
                      setEditingCompetition(null);
                    } catch (err) { console.error(err); alert('Fel vid uppdatering: ' + err.message); }
                  };

                  const cancelEditCompetition = () => setEditingCompetition(null);

                  const deleteCompetition = async (id) => {
                    try {
                      if (!confirm('√Ñr du s√§ker p√• att du vill ta bort delt√§vlingen? Detta tar √§ven bort kopplade po√§ng (dokumenten i scores m√•ste raderas separat om s√• √∂nskas).')) return;
                      await fdb.deleteDoc(fdb.doc(db, "competitions", id));
                      // Option: remove all scores for that competition (iterate scores and delete matching doc ids)
                      // h√§r v√§ljer vi att inte automatiskt radera - l√§mnar det √∂ppet
                    } catch (err) { console.error(err); alert('Fel vid borttagning: ' + err.message); }
                  };

                  // ---------- Shooters CRUD ----------
                  const addShooter = async () => {
                    try {
                      if (!newShooter.name || !newShooter.city) { alert('Fyll i namn och ort'); return; }
                      const maxStart = shooters.length ? Math.max(...shooters.map(s => s.startNumber || 0)) : 0;
                      const startNumber = maxStart + 1;
                      await fdb.addDoc(fdb.collection(db, "shooters"), {
                        name: newShooter.name,
                        city: newShooter.city,
                        class: newShooter.class,
                        startNumber
                      });
                      setNewShooter({ name: '', city: '', class: '√∂ppen' });
                    } catch (err) { console.error(err); alert('Fel vid skapande av skytt: ' + err.message); }
                  };

                  const startEditShooter = (s) => setEditingShooter({ id: s.id, name: s.name, city: s.city, class: s.class });

                  const saveEditShooter = async () => {
                    try {
                      if (!editingShooter) return;
                      const ref = fdb.doc(db, "shooters", editingShooter.id);
                      await fdb.updateDoc(ref, { name: editingShooter.name, city: editingShooter.city, class: editingShooter.class });
                      setEditingShooter(null);
                    } catch (err) { console.error(err); alert('Fel vid uppdatering: ' + err.message); }
                  };

                  const cancelEditShooter = () => setEditingShooter(null);

                  const deleteShooter = async (id) => {
                    try {
                      if (!confirm('Ta bort skytt och deras po√§ng?')) return;
                      await fdb.deleteDoc(fdb.doc(db, "shooters", id));
                      // Optionellt radera po√§ng - vi l√•ter scores ligga kvar eller skapa rens-funktion separat
                    } catch (err) { console.error(err); alert('Fel vid borttagning: ' + err.message); }
                  };

                  // ---------- Scoring ----------
                  const filteredShooters = shooters.filter(shooter =>
                    shooter.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    (shooter.startNumber && shooter.startNumber.toString().includes(searchTerm)) ||
                    shooter.city.toLowerCase().includes(searchTerm.toLowerCase())
                  );

                 const saveShots = async () => {
          try {
            if (!selectedShooter) return;
            if (!selectedCompetition) { alert('V√§lj en delt√§vling f√∂rst'); return; }

            const sum = currentShots.reduce((a,b) => a + (parseInt(b) || 0), 0);
            const key = `${selectedShooter.id}-${selectedCompetition}`;
            const stationIndex = selectedStation - 1;
            const ref = fdb.doc(db, "scores", key);

            // H√§mta befintliga scores fr√•n lokalt state (h√§mtas av onSnapshot)
            const existingScores = scores[key] || {};

            // Sl√• ihop ‚Äî bevara tidigare stationer och skriv √∂ver aktuell station
            const newScores = { ...existingScores, [stationIndex]: sum };

            // Spara hela scores-map:en (merge true f√∂r att bevara andra top-level f√§lt)
            await fdb.setDoc(ref, {
              shooterId: selectedShooter.id,
              competitionId: selectedCompetition,
              scores: newScores
            }, { merge: true });

            // Optimistisk UI-uppdatering s√• anv√§ndaren ser f√∂r√§ndringen direkt
            setScores(prev => ({ ...prev, [key]: newScores }));

            // Reset UI
            setCurrentShots(['', '', '', '', '']);
            setSelectedShooter(null);
          } catch (err) {
            console.error(err);
            alert('Fel vid sparande av skott: ' + err.message);
          }
        };


                  // ---------- Export (HTML som kan skrivas ut till PDF) ----------
                  const handleExportPDF = () => {
                    try {
                      const comp = competitions.find(c => c.id === selectedCompetition);
                      const selectedCompName = comp ? comp.name : 'Delt√§vling';
                      let htmlContent = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>Resultatlista - ${selectedCompName}</title>
                        <style>body{font-family:Arial;margin:20px;color:#111}h1{text-align:center;color:#2563eb}table{width:100%;border-collapse:collapse}th,td{border:1px solid #ddd;padding:8px;text-align:center}th{background:#f3f4f6}</style>
                        </head><body>
                        <h1>Landbys Cup - Resultatlista</h1>
                        <h2 style="text-align:center">${selectedCompName}</h2>
                        <p style="text-align:center;color:#666;">Genererad: ${new Date().toLocaleString('sv-SE')}</p>`;

                      const classesToShow = ['dam','√∂ppen','veteran','ungdom','junior med st√∂d'];

                      classesToShow.forEach(cls => {
                        const classShooters = shooters
                          .filter(s => s.class === cls)
                          .map(s => ({
                            ...s,
                            stations: Array(7).fill(0).map((_,i) => getStationScore(s.id, selectedCompetition, i)),
                            total: getTotalScore(s.id, selectedCompetition)
                          })).sort((a,b) => b.total - a.total);

                        if (classShooters.length === 0) return;

                        htmlContent += `<h3>${cls.charAt(0).toUpperCase()+cls.slice(1)}</h3><table><thead><tr><th>Plac.</th><th>Namn</th><th>Ort</th>`;
                        for (let i=1;i<=7;i++) htmlContent += `<th>S${i}</th>`;
                        htmlContent += `<th>Total</th></tr></thead><tbody>`;
                        classShooters.forEach((shooter, idx) => {
                          const place = idx < 3 ? (idx===0?'ü•á 1': idx===1?'ü•à 2':'ü•â 3') : (idx+1);
                          htmlContent += `<tr>${'<td>' + place + '</td>'}<td style="text-align:left">${shooter.name}</td><td style="text-align:left">${shooter.city}</td>`;
                          shooter.stations.forEach(s => htmlContent += `<td>${s || '-'}</td>`);
                          htmlContent += `<td>${shooter.total}</td></tr>`;
                        });
                        htmlContent += `</tbody></table><br/>`;
                      });

                      htmlContent += `<footer style="text-align:center;margin-top:40px;color:#666">Landbys Cup | ${new Date().getFullYear()}</footer></body></html>`;

                      // Open in new window / or download as HTML if popup blocked
                      const newWindow = window.open('', '_blank', 'width=900,height=700,scrollbars=yes');
                      if (newWindow) {
                        newWindow.document.open();
                        newWindow.document.write(htmlContent);
                        newWindow.document.close();
                        newWindow.focus();
                      } else {
                        const blob = new Blob([htmlContent], { type: 'text/html' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `resultat-${selectedCompName || 'deltavling'}.html`;
                        document.body.appendChild(a);
                        a.click();
                        a.remove();
                        setTimeout(() => URL.revokeObjectURL(url), 1000);
                        alert('HTML-fil nedladdad ‚Äî √∂ppna och skriv ut som PDF.');
                      }
                    } catch (err) {
                      console.error(err); alert('Fel vid export: ' + err.message);
                    }
                  };

                  // ---------- Render ----------
                  return (
                    <div className="min-h-screen">
                      <header className="bg-blue-600 text-white shadow-lg no-print">
                        <div className="container mx-auto p-4 flex items-center justify-between">
                          <h1 className="text-xl font-bold flex items-center gap-2"><Target className="w-6 h-6" />Landbys Cup</h1>
                          <div className="flex items-center gap-3">
                            <nav className="hidden md:flex gap-2">
                              {menuItems.map(item => {
                                const Icon = item.icon;
                                return (
                                  <button key={item.id} onClick={() => setActiveTab(item.id)}
                                    className={`px-4 py-2 rounded-md font-medium ${activeTab===item.id? 'bg-blue-800':'bg-blue-500/80 hover:bg-blue-700'}`}>
                                      <Icon className="inline w-4 h-4 mr-2" />{item.label}
                                  </button>
                                );
                              })}
                            </nav>
                            <button className="md:hidden px-4 py-2 bg-blue-500 rounded" onClick={() => setMenuOpen(!menuOpen)}>
                              {menuOpen ? '‚úï ST√ÑNG' : '‚ò∞ MENY'}
                            </button>
                          </div>
                        </div>
                        {menuOpen && (
                          <div className="bg-white text-gray-700">
                            <div className="container mx-auto p-2 flex flex-col gap-2">
                              {menuItems.map(item => (
                                <button key={item.id} onClick={() => { setActiveTab(item.id); setMenuOpen(false); }}
                                  className={`text-left px-4 py-3 rounded ${activeTab===item.id?'bg-blue-50 text-blue-700':''}`}>
                                  {item.label}
                                </button>
                              ))}
                            </div>
                          </div>
                        )}
                      </header>

                      <main className="container mx-auto p-4 custom-scrollbar">
                        {activeTab === 'competitions' && (
                          <div className="space-y-6">
                            <h2 className="text-xl font-semibold">Hantera Delt√§vlingar</h2>

                            <div className="bg-white p-6 rounded-lg shadow-sm">
                              <h3 className="text-lg font-medium mb-4">L√§gg till ny delt√§vling</h3>
                              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <input value={newCompetition.name} onChange={e => setNewCompetition({...newCompetition, name: e.target.value})}
                                  type="text" placeholder="Delt√§vlingsnamn" className="px-3 py-2 border rounded" />
                                <input value={newCompetition.date} onChange={e => setNewCompetition({...newCompetition, date: e.target.value})}
                                  type="date" className="px-3 py-2 border rounded" />
                                <button onClick={addCompetition} className="bg-blue-600 text-white px-4 py-2 rounded flex items-center gap-2">
                                  <Plus />L√§gg till
                                </button>
                              </div>
                            </div>

                            <div className="bg-white rounded-lg shadow-sm">
                              <div className="p-4 border-b">
                                <h3 className="text-lg font-medium">Delt√§vlingar</h3>
                              </div>
                              <div className="divide-y">
                                {competitions.map((comp, idx) => (
                                  <div key={comp.id} className="p-6">
                                    {editingCompetition && editingCompetition.id === comp.id ? (
                                      <div className="space-y-4">
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                          <input type="text" value={editingCompetition.name}
                                            onChange={e => setEditingCompetition({...editingCompetition, name: e.target.value})}
                                            className="px-3 py-2 border rounded text-lg" />
                                          <input type="date" value={editingCompetition.date}
                                            onChange={e => setEditingCompetition({...editingCompetition, date: e.target.value})}
                                            className="px-3 py-2 border rounded text-lg" />
                                        </div>
                                        <div className="flex gap-3">
                                          <button onClick={saveEditCompetition} className="bg-green-600 text-white px-6 py-3 rounded">Spara</button>
                                          <button onClick={cancelEditCompetition} className="bg-gray-500 text-white px-6 py-3 rounded">Avbryt</button>
                                        </div>
                                      </div>
                                    ) : (
                                      <div>
                                        <div className="flex items-center justify-between mb-4">
                                          <div>
                                            <h4 className="font-medium text-lg">{comp.name}</h4>
                                            <p className="text-sm text-gray-600">{comp.date}</p>
                                          </div>
                                          <div className="text-sm text-gray-500">Delt√§vling {idx+1}</div>
                                        </div>
                                        <div className="flex gap-3">
                                          <button onClick={() => startEditCompetition(comp)} className="bg-blue-100 text-blue-700 px-6 py-3 rounded">Redigera</button>
                                          <button onClick={() => { if (confirm('Ta bort?')) deleteCompetition(comp.id); }} className="bg-red-100 text-red-700 px-6 py-3 rounded">Ta bort</button>
                                        </div>
                                      </div>
                                    )}
                                  </div>
                                ))}
                              </div>
                            </div>
                          </div>
                        )}

                        {activeTab === 'shooters' && (
                          <div className="space-y-6">
                            <h2 className="text-xl font-semibold">Hantera Skyttar</h2>

                            <div className="bg-white p-6 rounded-lg shadow-sm">
                              <h3 className="text-lg font-medium mb-4">L√§gg till ny skytt</h3>
                              <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <input type="text" placeholder="Namn" value={newShooter.name} onChange={e => setNewShooter({...newShooter, name: e.target.value})} className="px-3 py-2 border rounded" />
                                <input type="text" placeholder="Ort" value={newShooter.city} onChange={e => setNewShooter({...newShooter, city: e.target.value})} className="px-3 py-2 border rounded" />
                                <select value={newShooter.class} onChange={e => setNewShooter({...newShooter, class: e.target.value})} className="px-3 py-2 border rounded">
                                  {classes.map(c => <option key={c} value={c}>{c}</option>)}
                                </select>
                                <button onClick={addShooter} className="bg-blue-600 text-white px-4 py-2 rounded flex items-center gap-2"><Plus/>L√§gg till</button>
                              </div>
                            </div>

                            <div className="bg-white rounded-lg shadow-sm">
                              <div className="p-4 border-b">
                                <h3 className="text-lg font-medium">Registrerade Skyttar ({shooters.length})</h3>
                              </div>
                              <div className="overflow-x-auto custom-scrollbar">
                                <table className="w-full">
                                  <thead className="bg-gray-50">
                                    <tr>
                                      <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Startnr</th>
                                      <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Namn</th>
                                      <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ort</th>
                                      <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Klass</th>
                                      <th className="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">√Ötg√§rder</th>
                                    </tr>
                                  </thead>
                                  <tbody className="divide-y divide-gray-200">
                                    {shooters.map(s => (
                                      <tr key={s.id}>
                                        {editingShooter && editingShooter.id === s.id ? (
                                          <td colSpan="5" className="p-6">
                                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                              <input type="text" value={editingShooter.name} onChange={e => setEditingShooter({...editingShooter, name: e.target.value})} className="px-3 py-2 border rounded" />
                                              <input type="text" value={editingShooter.city} onChange={e => setEditingShooter({...editingShooter, city: e.target.value})} className="px-3 py-2 border rounded" />
                                              <select value={editingShooter.class} onChange={e => setEditingShooter({...editingShooter, class: e.target.value})} className="px-3 py-2 border rounded">
                                                {classes.map(c => <option key={c} value={c}>{c}</option>)}
                                              </select>
                                            </div>
                                            <div className="flex gap-3 mt-4">
                                              <button onClick={saveEditShooter} className="bg-green-600 text-white px-6 py-3 rounded">Spara</button>
                                              <button onClick={cancelEditShooter} className="bg-gray-500 text-white px-6 py-3 rounded">Avbryt</button>
                                            </div>
                                          </td>
                                        ) : (
                                          <>
                                            <td className="px-4 py-4 whitespace-nowrap text-sm font-medium">{s.startNumber}</td>
                                            <td className="px-4 py-4 whitespace-nowrap text-sm">{s.name}</td>
                                            <td className="px-4 py-4 whitespace-nowrap text-sm text-gray-600">{s.city}</td>
                                            <td className="px-4 py-4 whitespace-nowrap text-sm"><span className="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs">{s.class}</span></td>
                                            <td className="px-4 py-4 whitespace-nowrap text-sm text-center">
                                              <div className="flex justify-center gap-2">
                                                <button onClick={() => startEditShooter(s)} className="bg-blue-100 text-blue-700 px-3 py-2 rounded">Redigera</button>
                                                <button onClick={() => { if (confirm('Ta bort skytt?')) deleteShooter(s.id); }} className="bg-red-100 text-red-700 px-3 py-2 rounded">Ta bort</button>
                                              </div>
                                            </td>
                                          </>
                                        )}
                                      </tr>
                                    ))}
                                  </tbody>
                                </table>
                              </div>
                            </div>
                          </div>
                        )}

                        {activeTab === 'scoring' && (
                          <div className="space-y-6">
                            <h2 className="text-xl font-semibold">Registrera Po√§ng</h2>

                            <div className="bg-white p-6 rounded-lg shadow-sm">
                              <h3 className="text-lg font-medium mb-4">V√§lj delt√§vling och station</h3>
                              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                  <label className="block text-sm font-medium text-gray-700 mb-1">Delt√§vling</label>
                                  <select value={selectedCompetition || ''} onChange={e => setSelectedCompetition(e.target.value)} className="px-3 py-2 border rounded w-full">
                                    {competitions.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}
                                  </select>
                                </div>
                                <div>
                                  <label className="block text-sm font-medium text-gray-700 mb-1">Station</label>
                                  <select value={selectedStation} onChange={e => setSelectedStation(parseInt(e.target.value))} className="px-3 py-2 border rounded w-full">
                                    {Array(7).fill(0).map((_,i) => <option key={i} value={i+1}>Station {i+1}</option>)}
                                  </select>
                                </div>
                              </div>
                            </div>

                            <div className="bg-white p-6 rounded-lg shadow-sm">
                              <h3 className="text-lg font-medium mb-4">S√∂k skytt</h3>
                              <div className="relative">
                                <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5 pointer-events-none" />
                                <input className="pl-10 pr-4 py-2 border rounded w-full" placeholder="S√∂k p√• namn, startnummer eller ort..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} />
                              </div>

                              {searchTerm && (
                                <div className="mt-4 max-h-60 overflow-y-auto custom-scrollbar space-y-2">
                                  {filteredShooters.map(s => (
                                    <button key={s.id} onClick={() => { setSelectedShooter(s); setSearchTerm(''); setCurrentShots(['','','','','']); }}
                                      className="w-full text-left p-3 border rounded flex justify-between items-center hover:bg-gray-50">
                                      <div>
                                        <div className="font-medium">{s.name}</div>
                                        <div className="text-sm text-gray-600">#{s.startNumber} ‚Ä¢ {s.city} ‚Ä¢ {s.class}</div>
                                      </div>
                                      <div className="text-sm text-gray-500">Station {selectedStation}: {getStationScore(s.id, selectedCompetition, selectedStation-1)} po√§ng</div>
                                    </button>
                                  ))}
                                </div>
                              )}
                            </div>

                            {selectedShooter && (
                              <div className="bg-white p-6 rounded-lg shadow-sm">
                                <div className="mb-6 p-4 bg-blue-50 rounded">
                                  <h3 className="text-lg font-medium text-blue-900">{selectedShooter.name} (#{selectedShooter.startNumber})</h3>
                                  <p className="text-sm text-blue-700">{competitions.find(c=>c.id===selectedCompetition)?.name} ‚Ä¢ Station {selectedStation}</p>
                                  <p className="text-xs text-blue-600 mt-1">Nuvarande po√§ng f√∂r station: {getStationScore(selectedShooter.id, selectedCompetition, selectedStation-1)}</p>
                                </div>

                                <h4 className="text-md font-medium mb-4">Registrera skott (max 5 skott)</h4>
                                <div className="grid grid-cols-2 md:grid-cols-5 gap-4 mb-4">
                                  {Array(5).fill(0).map((_, idx) => (
                                    <div key={idx}>
                                      <label className="block text-sm font-medium mb-1">Skott {idx+1}</label>
                                      <input type="number" min="0" max="10" value={currentShots[idx]} onChange={e => { const arr = [...currentShots]; arr[idx]=e.target.value; setCurrentShots(arr); }}
                                        className="w-full px-3 py-2 border rounded text-center text-lg" placeholder="0" />
                                    </div>
                                  ))}
                                </div>

                                <div className="mb-6 p-4 bg-gray-50 rounded">
                                  <div className="flex items-center justify-between">
                                    <span className="text-lg font-medium text-gray-700">Summa:</span>
                                    <span className="text-2xl font-bold text-blue-600">{currentShots.reduce((a,b)=>a+(parseInt(b)||0),0)} po√§ng</span>
                                  </div>
                                </div>

                                <div className="flex gap-3 flex-wrap">
                                  <button onClick={saveShots}
                                    disabled={currentShots.reduce((a,b)=>a+(parseInt(b)||0),0)===0}
                                    className={`px-6 py-2 rounded ${currentShots.reduce((a,b)=>a+(parseInt(b)||0),0)===0 ? 'bg-gray-300 text-gray-500' : 'bg-green-600 text-white hover:bg-green-700'}`}>
                                    Spara Po√§ng
                                  </button>
                                  <button onClick={()=>setCurrentShots(['','','','',''])} className="bg-orange-500 text-white px-6 py-2 rounded hover:bg-orange-600">Rensa Skott</button>
                                  <button onClick={()=>{ setSelectedShooter(null); setCurrentShots(['','','','','']); }} className="bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600">Avbryt</button>
                                </div>
                              </div>
                            )}
                          </div>
                        )}

                        {activeTab === 'results' && (
                          <div className="space-y-6">
                            <h2 className="text-xl font-semibold">Resultatlista</h2>

                            <div className="bg-white p-6 rounded-lg shadow-sm flex items-center justify-between flex-wrap gap-4">
                              <div>
                                <h3 className="text-lg font-medium mb-2">V√§lj delt√§vling</h3>
                                <select value={selectedCompetition||''} onChange={e => setSelectedCompetition(e.target.value)} className="px-3 py-2 border rounded">
                                  {competitions.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}
                                </select>
                              </div>
                              <div className="flex gap-3">
                                <button onClick={handleExportPDF} className="bg-red-600 text-white px-6 py-3 rounded">üìÑ Exportera PDF</button>
                              </div>
                            </div>

                            {['dam','√∂ppen','veteran','ungdom','junior med st√∂d'].map(cls => {
                              const classShooters = shooters.filter(s => s.class === cls)
                                .map(s => ({ ...s, stations: Array(7).fill(0).map((_,i)=>getStationScore(s.id, selectedCompetition, i)), total: getTotalScore(s.id, selectedCompetition)}))
                                .sort((a,b) => b.total - a.total);

                              if (classShooters.length === 0) return null;

                              return (
                                <div key={cls} className="bg-white rounded-lg shadow-sm overflow-hidden">
                                  <div className="p-4 border-b bg-blue-50">
                                    <h3 className="text-lg font-medium flex items-center gap-2"><Trophy className="w-5 h-5"/>{cls.charAt(0).toUpperCase()+cls.slice(1)}</h3>
                                    <p className="text-sm text-gray-600 mt-1">{competitions.find(c=>c.id===selectedCompetition)?.name}</p>
                                  </div>
                                  <div className="overflow-x-auto custom-scrollbar">
                                    <table className="w-full">
                                      <thead className="bg-gray-50">
                                        <tr>
                                          <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Placering</th>
                                          <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Namn</th>
                                          <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ort</th>
                                          {Array(7).fill(0).map((_,i)=>(<th key={i} className="px-2 py-3 text-center text-xs font-medium text-gray-500 uppercase">S{i+1}</th>))}
                                          <th className="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">Total</th>
                                        </tr>
                                      </thead>
                                      <tbody className="divide-y divide-gray-200">
                                        {classShooters.map((s, idx) => (
                                          <tr key={s.id} className={idx<3 ? 'bg-yellow-50' : ''}>
                                            <td className="px-4 py-4 whitespace-nowrap text-sm font-medium">{idx===0? 'ü•á 1' : idx===1? 'ü•à 2' : idx===2? 'ü•â 3' : idx+1}</td>
                                            <td className="px-4 py-4 whitespace-nowrap text-sm font-medium">{s.name}</td>
                                            <td className="px-4 py-4 whitespace-nowrap text-sm text-gray-600">{s.city}</td>
                                            {s.stations.map((st, i)=>(<td key={i} className="px-2 py-4 text-center whitespace-nowrap">{st || '-'}</td>))}
                                            <td className="px-4 py-4 whitespace-nowrap text-sm font-bold text-center">{s.total}</td>
                                          </tr>
                                        ))}
                                      </tbody>
                                    </table>
                                  </div>
                                </div>
                              );
                            })}
                          </div>
                        )}
                      </main>
                    </div>
                  );
                }

                ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
